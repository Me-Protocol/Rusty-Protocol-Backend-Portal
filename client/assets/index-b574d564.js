import{aT as H,by as J,bz as K,bE as U,j as e,aW as V,aX as W,u as X,d as O,b as Q,a as Z,$ as ee,bH as ae,r as h,bI as oe,h as ie,F as i,G as C,I as ne,K as I,T as n,U as F,C as M,l as L,D,bJ as te,aq as se,a2 as f,g as le,B as ce,bK as re}from"./index-f182da16.js";import{S as de}from"./index-0f1e5a48.js";import"./index-ebf179b7.js";function xe(c,d=[]){const t=Object.assign({},c);for(const r of d)r in t&&delete t[r];return t}var ue=["h","minH","height","minHeight"],_=H((c,d)=>{const t=J("Textarea",c),{className:r,rows:p,...x}=K(c),m=U(x),a=p?xe(t,ue):t;return e.jsx(V.textarea,{ref:d,rows:p,...m,className:W("chakra-textarea",r),__css:a})});_.displayName="Textarea";const we=({name:c,price:d,token:t,quantity:r,date:p,expired:x,image:m,rest:a})=>{const{root:$,bodyText:s,headText:B}=he();let j=X();const{token:S}=O(o=>o.authReducer),u=Q(),E=Z(),{isOpen:P,onOpen:z,onClose:w}=ee(),{task_instruction_details:l}=O(o=>o.bountyReducer),[N]=ae(),[g,b]=h.useState(null),[Y,T]=h.useState(!1),[v,y]=h.useState(""),[R,k]=h.useState(""),{data:fe,refetch:q}=oe({offerId:a==null?void 0:a.offerId},{refetchOnMountOrArgChange:!0,skip:!t});async function G(){if(!R){f(u,"Please input all fields");return}if(v.split(" ").length<5){f(u,"At least five characters required");return}if(!g){f(u,"Please select a rating");return}T(!0),await N({title:R,review:v,offerId:a==null?void 0:a.offerId,rating:g.toString()}).then(async o=>{var A;((A=o==null?void 0:o.data)==null?void 0:A.statusCode)===200&&(q(),f(u,"Review submitted",5e3,"bottom-right"),w(),b(null),y(""),k("")),l&&(await le.post(`${ce}/tasks/complete_user_task`,{task_id:l==null?void 0:l.id},{headers:{Authorization:`Bearer ${S}`}}),E(re({task_id:l==null?void 0:l.id,token:S})))}).catch(o=>{console.log(o,"AddReviewToOfferErr")}).finally(()=>{T(!1)})}return e.jsxs(ie,{children:[e.jsxs(i,{...$,flexDir:"row",align:"center",children:[e.jsxs(i,{w:"30%",h:"70%",flexDir:"row",align:"center",justify:"space-between",children:[e.jsx(i,{w:"100px",h:"100px",flexDir:"column",bg:"grey",as:"button",onClick:()=>{var o;j(`${C}/productDetails/${(o=a==null?void 0:a.offer)==null?void 0:o.offerCode}`)},children:e.jsx(ne,{objectFit:"cover",src:m,w:"100%",h:"100%",bg:"grey",mixBlendMode:"multiply"})}),e.jsx(I,{}),e.jsxs(i,{flexDir:"column",w:"70%",h:"100px",children:[e.jsx(n,{...B,noOfLines:1,children:c}),e.jsx(I,{}),e.jsx(n,{...s,children:t}),e.jsxs(n,{...s,children:["Purchased: ",F(a==null?void 0:a.updatedAt).fromNow()]})]})]}),x&&e.jsxs(i,{w:"30%",h:"70%",flexDir:"column",align:"flex-end",children:[e.jsx(n,{...s,color:"dark",children:"Expires"}),e.jsx(n,{...s,children:F(a==null?void 0:a.updatedAt).format("DD MMM YYYY")})]}),e.jsxs(i,{w:"30%",h:"70%",align:"flex-end",flexDir:"column",children:[e.jsx(M,{...s,as:L,_hover:{bg:"dark"},color:"light",w:"35%",h:"30%",isDisabled:!(a!=null&&a.coupon),bg:"dark",onClick:()=>{j(`${C}/dashboard_my_deals_details`,{state:{...a}})},children:"View details"}),e.jsx(n,{as:"button",...s,opacity:a!=null&&a.couponId?1:.4,onClick:()=>{a.couponId&&z()},children:x?"View voucher":"Leave Review"}),e.jsx(n,{as:a!=null&&a.isRedeemed?"text":"button",...s,children:a!=null&&a.isRedeemed?"Redeemed":`Status: ${a.status}`}),e.jsx(n,{as:"button",...s,opacity:a!=null&&a.couponId?1:.4,onClick:()=>{var o;a.couponId&&j(`${C}/productDetails/${(o=a==null?void 0:a.offer)==null?void 0:o.offerCode}`)},children:"Buy it again"})]})]}),e.jsx(D,{}),e.jsxs(te,{isOpen:P,onClose:w,closeOnOverlayClick:!0,children:[e.jsx(n,{mb:"24px",children:"Leave review"}),e.jsx(D,{}),e.jsxs(i,{mt:"16px",mb:"16px",flexDir:"column",justify:"center",alignItems:"center",children:[e.jsx(n,{children:"My overall rating"}),e.jsx(i,{children:e.jsx(de,{name:"rate2",starColor:"#000000",emptyStarColor:"#999999",starCount:5,value:g,onStarClick:o=>{b(o)}})})]}),e.jsx(D,{}),e.jsxs(i,{mt:"20px",flexDir:"column",children:[e.jsx(i,{w:"100%",children:e.jsx(se,{variant:"outline",borderRadius:"0px",value:R,onChange:({target:o})=>k(o.value),h:"46px",placeholder:"Review headline or summary",_placeholder:{opacity:1,color:"#AFAFAF"}})}),e.jsx(i,{mt:"16px",w:"100%",flexDir:"column",children:e.jsx(_,{variant:"outline",borderRadius:"0px",value:v,onChange:({target:o})=>y(o.value),placeholder:"Write your review here. It must be at least 5 characters long.",_placeholder:{opacity:1,color:"#AFAFAF"},size:"sm"})})]}),e.jsx(i,{align:"center",mt:"24px",children:e.jsx(L,{isLoading:Y,w:"100%",h:"48px",bg:"black",_hover:{bg:"dark"},onClick:()=>G(),children:e.jsx(n,{color:"white",children:"Submit"})})}),e.jsx(i,{align:"center",mt:"10px",children:e.jsx(M,{as:"button",w:"100%",h:"48px",border:"1px solid black",onClick:()=>{b(null),y(""),k(""),w()},children:e.jsx(n,{color:"black",children:"Cancel"})})})]})]})},he=()=>({root:{w:"100%",h:"150px",justify:"space-between"},headText:{fontSize:"16px"},bodyText:{fontSize:"12px",color:"#999999"}});export{we as default};
