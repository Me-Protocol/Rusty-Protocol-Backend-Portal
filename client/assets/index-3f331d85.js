import{u as _,d as k,b as G,a as q,O as N,bc as V,r as c,bd as W,j as e,h as J,F as i,G as b,I as Q,w as A,T as n,y as D,C as O,l as S,al as m,be as U,bf as X,aj as H,bg as K,W as d,g as Z,B as ee,bh as ae}from"./index-1596cd59.js";const ce=({name:T,price:ie,token:v,quantity:ne,date:le,expired:g,image:I,rest:a})=>{const{root:F,bodyText:l,headText:M}=oe();let r=_();const{token:R}=k(o=>o.authReducer),s=G(),L=q(),{isOpen:$,onOpen:B,onClose:x}=N(),{task_instruction_details:t}=k(o=>o.bountyReducer),[E]=V(),[u,h]=c.useState(null),[z,y]=c.useState(!1),[f,p]=c.useState(""),[j,w]=c.useState(""),{data:te,refetch:P}=W({offerId:a==null?void 0:a.offerId},{refetchOnMountOrArgChange:!0,skip:!v});async function Y(){if(!j){d(s,"Please input all fields");return}if(f.split(" ").length<5){d(s,"At least five characters required");return}if(!u){d(s,"Please select a rating");return}y(!0),await E({title:j,review:f,offerId:a==null?void 0:a.offerId,rating:u.toString()}).then(async o=>{var C;((C=o==null?void 0:o.data)==null?void 0:C.statusCode)===200&&(P(),d(s,"Review submitted",5e3,"bottom-right"),x(),h(null),p(""),w("")),t&&(await Z.post(`${ee}/tasks/complete_user_task`,{task_id:t==null?void 0:t.id},{headers:{Authorization:`Bearer ${R}`}}),L(ae({task_id:t==null?void 0:t.id,token:R})))}).catch(o=>{console.log(o,"AddReviewToOfferErr")}).finally(()=>{y(!1)})}return e.jsxs(J,{children:[e.jsxs(i,{...F,flexDir:"row",align:"center",children:[e.jsxs(i,{w:"30%",h:"70%",flexDir:"row",align:"center",justify:"space-between",children:[e.jsx(i,{w:"100px",h:"100px",flexDir:"column",bg:"grey",as:"button",onClick:()=>{var o;r(`${b}/product-details/${(o=a==null?void 0:a.offer)==null?void 0:o.offerCode}`)},children:e.jsx(Q,{objectFit:"cover",src:I,w:"100%",h:"100%",bg:"grey",mixBlendMode:"multiply"})}),e.jsx(A,{}),e.jsxs(i,{flexDir:"column",w:"70%",h:"100px",children:[e.jsx(n,{...M,noOfLines:1,children:T}),e.jsx(A,{}),e.jsx(n,{...l,children:v}),e.jsxs(n,{...l,children:["Redeemed: ",D(a==null?void 0:a.updatedAt).fromNow()]})]})]}),g&&e.jsxs(i,{w:"30%",h:"70%",flexDir:"column",align:"flex-end",children:[e.jsx(n,{...l,color:"dark",children:"Expires"}),e.jsx(n,{...l,children:D(a==null?void 0:a.updatedAt).format("DD MMM YYYY")})]}),e.jsxs(i,{w:"30%",h:"70%",align:"flex-end",flexDir:"column",children:[e.jsx(O,{...l,as:S,_hover:{bg:"dark"},color:"light",w:"35%",h:"30%",isDisabled:!(a!=null&&a.coupon),bg:"dark",onClick:()=>{r(`${b}/dashboard-my-deals-details`,{state:{...a}})},children:"View details"}),e.jsx(n,{as:"button",...l,opacity:a!=null&&a.couponId?1:.4,onClick:()=>{a.couponId&&B()},children:g?"View voucher":"Leave Review"}),e.jsx(n,{as:a!=null&&a.isRedeemed?"text":"button",...l,children:a!=null&&a.isRedeemed?"Redeemed":`Status: ${a.status}`}),e.jsx(n,{as:"button",...l,opacity:a!=null&&a.couponId?1:.4,onClick:()=>{var o;a.couponId&&r(`${b}/product-details/${(o=a==null?void 0:a.offer)==null?void 0:o.offerCode}`)},children:"Redeem again"})]})]}),e.jsx(m,{}),e.jsxs(U,{isOpen:$,onClose:x,closeOnOverlayClick:!0,children:[e.jsx(n,{mb:"24px",children:"Leave review"}),e.jsx(m,{}),e.jsxs(i,{mt:"16px",mb:"16px",flexDir:"column",justify:"center",alignItems:"center",children:[e.jsx(n,{children:"My overall rating"}),e.jsx(i,{children:e.jsx(X,{name:"rate2",starColor:"#000000",emptyStarColor:"#999999",starCount:5,value:u,onStarClick:o=>{h(o)}})})]}),e.jsx(m,{}),e.jsxs(i,{mt:"20px",flexDir:"column",children:[e.jsx(i,{w:"100%",children:e.jsx(H,{variant:"outline",borderRadius:"0px",value:j,onChange:({target:o})=>w(o.value),h:"46px",placeholder:"Review headline or summary",_placeholder:{opacity:1,color:"#AFAFAF"}})}),e.jsx(i,{mt:"16px",w:"100%",flexDir:"column",children:e.jsx(K,{variant:"outline",borderRadius:"0px",value:f,onChange:({target:o})=>p(o.value),placeholder:"Write your review here. It must be at least 5 characters long.",_placeholder:{opacity:1,color:"#AFAFAF"},size:"sm"})})]}),e.jsx(i,{align:"center",mt:"24px",children:e.jsx(S,{isLoading:z,w:"100%",h:"48px",bg:"black",_hover:{bg:"dark"},onClick:()=>Y(),children:e.jsx(n,{color:"white",children:"Submit"})})}),e.jsx(i,{align:"center",mt:"10px",children:e.jsx(O,{as:"button",w:"100%",h:"48px",border:"1px solid black",onClick:()=>{h(null),p(""),w(""),x()},children:e.jsx(n,{color:"black",children:"Cancel"})})})]})]})},oe=()=>({root:{w:"100%",h:"150px",justify:"space-between"},headText:{fontSize:"16px"},bodyText:{fontSize:"12px",color:"#999999"}});export{ce as default};
